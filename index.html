<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Object Tracking + Direction Commands</title>
    <style>
        body { font-family: Arial; text-align: center; background: #111; color: #fff; }
        #video, #canvas { width: 80%; max-width: 400px; margin-top: 10px; border-radius: 10px; }
        #command { font-size: 22px; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

<h2>Object Tracking + Direction Detection</h2>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<div id="command">Detecting...</div>

<script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const commandBox = document.getElementById("command");

    // Ask for camera
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
        video.srcObject = stream;
    });

    video.addEventListener("loadeddata", () => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        track();
    });

    function track() {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        let frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let data = frame.data;

        let targetColor = { r: 255, g: 0, b: 0 }; // TRACKING RED OBJECT
        let threshold = 80;

        let cx = 0, cy = 0, count = 0;

        // Scan pixels
        for (let i = 0; i < data.length; i += 4) {
            let r = data[i];
            let g = data[i + 1];
            let b = data[i + 2];

            if (Math.abs(r - targetColor.r) < threshold &&
                Math.abs(g - targetColor.g) < threshold &&
                Math.abs(b - targetColor.b) < threshold) {

                let pixelIndex = i / 4;
                let x = pixelIndex % canvas.width;
                let y = Math.floor(pixelIndex / canvas.width);

                cx += x;
                cy += y;
                count++;

                // Mark detected pixel
                data[i] = 0;    // color pixels blue
                data[i + 1] = 0;
                data[i + 2] = 255;
            }
        }

        ctx.putImageData(frame, 0, 0);

        if (count > 50) {
            cx /= count;
            cy /= count;

            // Draw center dot
            ctx.beginPath();
            ctx.arc(cx, cy, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "yellow";
            ctx.fill();

            checkDirection(cx, cy);
        } else {
            commandBox.innerText = "Object not found!";
        }

        requestAnimationFrame(track);
    }

    function checkDirection(x, y) {
        let midX = canvas.width / 2;
        let midY = canvas.height / 2;

        let tolerance = 40;

        let cmd = "";

        // LEFT / RIGHT
        if (x < midX - tolerance) cmd += "Move Right (object is LEFT)\n";
        else if (x > midX + tolerance) cmd += "Move Left (object is RIGHT)\n";
        else cmd += "Aligned Left/Right\n";

        // UP / DOWN (distance simulation)
        if (y < midY - tolerance) cmd += "Move Forward (object UP)\n";
        else if (y > midY + tolerance) cmd += "Move Backward (object DOWN)\n";
        else cmd += "Aligned Up/Down\n";

        // PERFECTLY CENTERED
        if (Math.abs(x - midX) < tolerance && Math.abs(y - midY) < tolerance) {
            cmd = "Object Centered âœ”";
        }

        commandBox.innerText = cmd;
    }
</script>

</body>
</html>
