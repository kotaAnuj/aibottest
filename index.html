<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AI Object Tracking + Commands</title>
  <style>
      body { background:#111; color:white; text-align:center; font-family:Arial; }
      video, canvas { width:80%; max-width:400px; margin-top:10px; border-radius:10px; }
      #cmd { font-size:25px; margin-top:20px; }
  </style>
</head>
<body>

<h2>AI Object Tracking + Direction Commands</h2>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<div id="cmd">Loading model…</div>

<!-- Load TensorFlow + COCO-SSD Model -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const cmdBox = document.getElementById("cmd");

// 1. Start Camera
navigator.mediaDevices.getUserMedia({ video:true }).then(stream => {
    video.srcObject = stream;
});

// 2. Load Model
let model;
cocoSsd.load().then(m => {
    model = m;
    cmdBox.innerText = "Model Ready — Detecting…";
    detectLoop();
});

// 3. Main detection loop
function detectLoop() {
    if (!model) return requestAnimationFrame(detectLoop);

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    model.detect(video).then(predictions => {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        let target = null;

        // find PERSON first
        for (let p of predictions) {
            if (p.class === "person" && p.score > 0.5) {
                target = p; break;
            }
        }

        // if no person → take first object
        if (!target && predictions.length > 0) {
            target = predictions[0];
        }

        if (target) {
            let [x, y, w, h] = target.bbox;
            let cx = x + w/2;
            let cy = y + h/2;

            // Draw box
            ctx.strokeStyle = "lime";
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y, w, h);

            // Draw center dot
            ctx.beginPath();
            ctx.arc(cx, cy, 8, 0, Math.PI*2);
            ctx.fillStyle = "yellow";
            ctx.fill();

            // Show label
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.fillText(target.class, x, y-5);

            // Direction logic
            giveDirection(cx, cy, w, h);
        } else {
            cmdBox.innerText = "No object detected";
        }

        requestAnimationFrame(detectLoop);
    });
}

// 4. Direction Logic
function giveDirection(cx, cy, w, h) {
    let midX = canvas.width / 2;
    let midY = canvas.height / 2;

    let tol = 40;
    let dist = w * h;

    let cmd = "";

    // LEFT / RIGHT based on x
    if (cx < midX - tol) cmd += "Move Right (Object is Left)\n";
    else if (cx > midX + tol) cmd += "Move Left (Object is Right)\n";
    else cmd += "Aligned Left/Right ✓\n";

    // FORWARD / BACK based on size of box
    if (dist < 80000) cmd += "Go Closer (Object Far)\n";
    else if (dist > 200000) cmd += "Go Back (Object Too Close)\n";
    else cmd += "Distance OK ✓\n";

    // PERFECT CENTER
    if (Math.abs(cx - midX) < tol && dist > 80000 && dist < 200000) {
        cmd = "Perfectly Centered ✔";
    }

    cmdBox.innerText = cmd;
}
</script>

</body>
</html>
